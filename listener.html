<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Radio-Lab Listener</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://sdk.scdn.co https://cdn.jsdelivr.net; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://sdk.scdn.co https://api.spotify.com https://accounts.spotify.com https://*.spotify.com https://*.scdn.co https://apresolve.spotify.com https://*.supabase.co https://*.supabase.net wss://*.spotify.com; img-src 'self' data: https://i.scdn.co https://*.supabase.co https://*.supabase.net; media-src 'self' data: blob: https://*.supabase.co https://*.supabase.net; frame-src 'self' https://sdk.scdn.co; base-uri 'self'; form-action 'self'">
  <meta name="referrer" content="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://sdk.scdn.co/spotify-player.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="noise"></div>
  <header class="hero">
    <div class="title-block">
      <p class="tag">interplanetary radio show</p>
      <h1>LISTENER</h1>
      <p class="lede">Play finished radio shows with cover art, metadata, and comments.</p>
      <div class="status-chip" id="spotify-status">spotify: disconnected</div>
      <div class="top-actions">
        <a class="ghost small nav-link" href="index.html">Builder</a>
      </div>
    </div>
  </header>

  <main class="grid">
    <section class="panel listen-header">
      <div class="panel-head">
        <h2>Load Show</h2>
        <span class="hint">JSON export from builder</span>
      </div>
      <div class="listen-controls">
        <div class="control-left">
          <label class="field">
            <span>OAuth token</span>
            <input id="token-input" type="password" placeholder="Spotify token with streaming scopes" />
          </label>
          <div class="row wrap">
            <button id="connect-btn" class="primary">Connect Player</button>
            <input id="file-input" type="file" accept="application/json" />
          </div>
        </div>
        <div class="control-center">
          <button id="prev-btn" class="ghost small">Prev</button>
          <button id="play-btn" class="primary">Play Current</button>
          <button id="next-btn" class="ghost small">Next</button>
          <button id="stop-btn" class="ghost">Stop</button>
        </div>
      </div>
    </section>

    <section class="panel now">
      <div class="panel-head">
        <h2 id="session-title">No show loaded</h2>
        <span class="hint" id="session-meta"></span>
      </div>
      <div class="row wrap">
        <div class="cover" id="cover"></div>
        <div class="now-text">
          <div class="title" id="now-title">—</div>
          <div class="subtitle" id="now-subtitle">—</div>
          <div class="subtitle" id="now-note"></div>
          <div class="progress">
            <div class="progress-bar"><div id="progress-fill"></div></div>
            <div class="progress-bar total"><div id="total-fill"></div></div>
          </div>
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="panel-head">
        <h2>Top Sessions</h2>
        <span class="hint">Supabase-backed (falls back to static)</span>
      </div>
      <div class="row wrap">
        <button id="refresh-top-btn" class="ghost small">Refresh</button>
        <input id="session-search" type="text" placeholder="Filter sessions..." />
      </div>
      <ul id="top-sessions" class="list"></ul>
    </section>

    <section class="panel">
      <div class="panel-head">
        <h2>Segments</h2>
      </div>
      <ul id="segments" class="list segments"></ul>
    </section>
  </main>

  <div class="listen-bar" id="listen-bar">
    <div class="bar-cover" id="bar-cover"></div>
    <div class="bar-meta">
      <div class="bar-title" id="bar-title">—</div>
      <div class="bar-subtitle" id="bar-subtitle">—</div>
    </div>
    <div class="bar-controls">
      <button id="bar-play" class="ghost small">Play</button>
      <button id="bar-stop" class="ghost small">Stop</button>
    </div>
    <div class="bar-progress" id="bar-progress">
      <div class="bar-progress-fill" id="bar-progress-fill"></div>
    </div>
  </div>
  <script src="listener.js" defer></script>
</body>
</html>
