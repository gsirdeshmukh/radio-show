<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Radio-Lab Listener</title>
	  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://sdk.scdn.co https://cdn.jsdelivr.net; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://sdk.scdn.co https://api.spotify.com https://accounts.spotify.com https://*.spotify.com https://*.scdn.co https://apresolve.spotify.com https://*.supabase.co https://*.supabase.net wss://*.spotify.com wss://*.supabase.co wss://*.supabase.net stun: turn:; img-src 'self' data: https://i.scdn.co https://*.supabase.co https://*.supabase.net; media-src 'self' data: blob: https://*.supabase.co https://*.supabase.net; frame-src 'self' https://sdk.scdn.co; base-uri 'self'; form-action 'self'">
  <meta name="referrer" content="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://sdk.scdn.co/spotify-player.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="noise"></div>
  <header class="hero-shell listener-hero">
    <div class="hero-card">
      <div class="title-block">
        <p class="tag">interplanetary radio show</p>
        <h1>LISTENER</h1>
        <p class="lede">Play finished radio shows with cover art, metadata, and comments.</p>
      </div>
      <div class="status-row">
        <div class="status-chip" id="spotify-status">spotify: disconnected</div>
        <div class="status-chip subtle" id="supabase-auth-status">supabase: signed out</div>
      </div>
      <div class="top-actions">
        <button id="connect-toggle" class="ghost small">Account</button>
        <a class="ghost small nav-link" href="index.html">Builder</a>
      </div>
    </div>
  </header>

  <section class="panel connect floating collapsed" id="connect-panel">
    <div class="panel-head">
      <h2>Account</h2>
      <span class="hint">social + nearby + inbox</span>
      <button id="connect-close" class="ghost small">Close</button>
    </div>

    <div class="subhead">Supabase</div>
    <label class="field">
      <span>Supabase URL</span>
      <input id="supabase-url" type="text" placeholder="https://xxxx.supabase.co" autocomplete="off" />
    </label>
    <label class="field">
      <span>Supabase anon key</span>
      <input id="supabase-key" type="password" placeholder="anon/public key" autocomplete="off" />
    </label>
    <div class="subhead">Supabase Auth</div>
    <label class="field">
      <span>Email</span>
      <input id="supabase-email" type="text" placeholder="you@example.com" autocomplete="email" />
    </label>
    <div class="row wrap">
      <button id="supabase-signin" class="ghost small">Email Link</button>
      <button id="supabase-signout" class="ghost small" disabled>Sign Out</button>
    </div>

    <div class="divider"></div>
    <div class="subhead">Profile</div>
    <label class="field">
      <span>Handle</span>
      <input id="profile-handle" type="text" placeholder="handle (public)" autocomplete="off" />
    </label>
    <div class="row wrap">
      <label class="field small">
        <span>Zip</span>
        <input id="profile-zip" type="text" placeholder="10001" autocomplete="postal-code" />
      </label>
      <label class="field small">
        <span>Location opt-in</span>
        <input id="profile-location-optin" type="checkbox" />
      </label>
      <button id="profile-save-btn" class="ghost small">Save Profile</button>
    </div>

    <div class="subhead">Follow</div>
    <div class="row wrap">
      <label class="field">
        <span>Follow handle</span>
        <input id="follow-handle" type="text" placeholder="@someone" autocomplete="off" />
      </label>
      <button id="follow-btn" class="ghost small">Follow</button>
    </div>
  </section>

  <main class="grid listener-grid">
    <section class="panel listen listen-header">
      <div class="panel-head">
        <h2>Load Show</h2>
        <span class="hint">JSON export from builder</span>
      </div>
      <div class="listen-controls">
        <div class="control-left">
          <label class="field">
            <span>OAuth token</span>
            <input id="token-input" type="password" placeholder="Spotify token with streaming scopes" />
          </label>
          <div class="row wrap">
            <button id="connect-btn" class="primary">Connect Player</button>
            <input id="file-input" type="file" accept="application/json" />
          </div>
        </div>
        <div class="control-center">
          <button id="prev-btn" class="ghost small">Prev</button>
          <button id="play-btn" class="primary">Play Current</button>
          <button id="next-btn" class="ghost small">Next</button>
          <button id="stop-btn" class="ghost">Stop</button>
        </div>
      </div>
    </section>

    <section class="panel now listen-now">
      <div class="panel-head">
        <h2 id="session-title">No show loaded</h2>
        <span class="hint" id="session-meta"></span>
      </div>
      <div class="row wrap">
        <div class="cover" id="cover"></div>
        <div class="now-text">
          <div class="title" id="now-title">—</div>
          <div class="subtitle" id="now-subtitle">—</div>
          <div class="subtitle" id="now-note"></div>
          <div class="progress">
            <div class="progress-bar"><div id="progress-fill"></div></div>
            <div class="progress-bar total"><div id="total-fill"></div></div>
          </div>
        </div>
      </div>
    </section>

    <section class="panel sessions" id="sessions-panel">
      <div class="panel-head">
        <h2>Sessions</h2>
        <span class="hint" id="sessions-status">—</span>
      </div>
      <div class="row wrap">
        <input id="sessions-search" type="text" placeholder="Search sessions..." />
	        <select id="sessions-feed">
	          <option value="public">Public</option>
	          <option value="following">Following</option>
	          <option value="nearby">Nearby</option>
	          <option value="inbox">Inbox</option>
	          <option value="live">Live</option>
	          <option value="live_nearby">Live (Nearby)</option>
	        </select>
        <select id="sessions-sort">
          <option value="new">Newest</option>
          <option value="plays">Most plays</option>
          <option value="downloads">Most downloads</option>
          <option value="likes">Most likes</option>
        </select>
        <button id="sessions-refresh" class="ghost small">Refresh</button>
        <button id="go-live-btn" class="ghost small">Go Live</button>
        <button id="end-live-btn" class="ghost small" disabled>End Live</button>
      </div>
      <ul id="sessions-list" class="list"></ul>
    </section>

    <section class="panel show segments-panel">
      <div class="panel-head">
        <h2>Segments</h2>
      </div>
      <ul id="segments" class="list segments"></ul>
    </section>
  </main>

  <section class="panel live-room collapsed" id="live-room">
    <div class="panel-head">
      <h2 id="live-room-title">Live Room</h2>
      <span class="hint" id="live-room-subtitle">—</span>
      <button id="live-room-close" class="ghost small">Close</button>
    </div>
    <ul id="live-room-events" class="list live-events"></ul>
    <div class="row live-audio">
      <button id="live-room-audio-btn" class="ghost small" type="button">Enable Audio</button>
      <button id="live-room-mic-btn" class="ghost small" type="button">Enable Mic</button>
      <span class="hint" id="live-room-audio-status">—</span>
    </div>
    <div class="row live-composer">
      <input id="live-room-message" type="text" placeholder="Say something…" autocomplete="off" />
      <button id="live-room-send" class="primary">Send</button>
    </div>
    <audio id="live-room-audio" playsinline></audio>
  </section>

  <div class="listen-bar" id="listen-bar">
    <div class="bar-cover" id="bar-cover"></div>
    <div class="bar-meta">
      <div class="bar-title" id="bar-title">—</div>
      <div class="bar-subtitle" id="bar-subtitle">—</div>
    </div>
    <div class="bar-controls">
      <button id="bar-play" class="ghost small">Play</button>
      <button id="bar-stop" class="ghost small">Stop</button>
    </div>
    <div class="bar-progress" id="bar-progress">
      <div class="bar-progress-fill" id="bar-progress-fill"></div>
    </div>
  </div>
  <script src="listener.js" defer></script>
</body>
</html>
