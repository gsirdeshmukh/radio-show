<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Radio Show — Spotify + Voice</title>
	  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://sdk.scdn.co https://cdn.jsdelivr.net https://js-cdn.music.apple.com; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; connect-src 'self' data: https://sdk.scdn.co https://api.spotify.com https://accounts.spotify.com https://*.spotify.com https://*.scdn.co https://apresolve.spotify.com https://*.supabase.co https://*.supabase.net https://api-v2.soundcloud.com https://api.soundcloud.com https://*.sndcdn.com https://corsproxy.io wss://*.spotify.com wss://*.supabase.co wss://*.supabase.net stun: turn:; img-src 'self' data: https://i.scdn.co https://*.supabase.co https://*.supabase.net; media-src 'self' data: blob: https://*.supabase.co https://*.supabase.net https://cf-media.sndcdn.com https://cf-hls-media.sndcdn.com https://media.soundcloud.com https://*.sndcdn.com; frame-src 'self' https://sdk.scdn.co; base-uri 'self'; form-action 'self'">
  <meta name="referrer" content="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://sdk.scdn.co/spotify-player.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js"></script>
</head>
<body>
  <div class="noise"></div>
  <header class="hero-shell">
    <div class="hero-card">
      <div class="title-block">
        <p class="tag">interplanetary radio show</p>
        <h1>RADIO-LAB</h1>
        <p class="lede">curate, speak, share.</p>
      </div>
      <div class="status-row">
        <div class="status-chip" id="spotify-status">spotify: disconnected</div>
        <div id="ticker" class="ticker"><span>now playing: —</span></div>
      </div>
      <div class="top-actions">
        <button id="connect-toggle" class="ghost small">Auth Panel</button>
      </div>
    </div>

    <section class="search-wrap">
      <div class="panel-head compact">
        <h2>Find Tracks</h2>
        <span class="hint">search Spotify</span>
      </div>
      <form id="search-form" class="row search-row">
        <input id="search-input" type="text" placeholder="Search tracks..." autocomplete="off" />
        <button type="submit" class="primary">Search</button>
      </form>
      <div class="row wrap search-actions">
        <button id="library-btn" class="ghost small">Saved Tracks</button>
        <button id="playlists-btn" class="ghost small">My Playlists</button>
        <button id="clear-results-btn" class="ghost small">Clear</button>
      </div>
      <ul id="results" class="list compact-list"></ul>
      <div class="subhead">SoundCloud (mobile-friendly)</div>
      <form id="sc-search-form" class="row search-row">
        <input id="sc-search-input" type="text" placeholder="Search SoundCloud..." autocomplete="off" />
        <button type="submit" class="ghost">Search SC</button>
      </form>
      <div class="row wrap">
        <button id="soundcloud-likes-btn" class="ghost small" disabled>My Likes</button>
      </div>
      <ul id="sc-results" class="list compact-list"></ul>
    </section>

    <div class="profile-stack">
      <div class="profile-chip" id="profile-chip" title="Linked Spotify account">
        <div class="profile-avatar" id="profile-avatar"></div>
        <div class="profile-name" id="profile-name">Not linked</div>
      </div>
      <div class="switch-group">
        <span class="switch-label">theme</span>
        <div class="theme-switch" id="theme-switch">
          <button class="theme-dot" data-theme="default" title="Aqua">◼</button>
          <button class="theme-dot" data-theme="ember" title="Ember">◼</button>
          <button class="theme-dot" data-theme="sunset" title="Sunset">◼</button>
          <button class="theme-dot" data-theme="violet" title="Violet">◼</button>
          <button class="theme-dot" data-theme="frost" title="Frost">◼</button>
        </div>
      </div>
      <div class="switch-group">
        <span class="switch-label">font</span>
        <div class="font-switch" id="font-switch">
          <button class="font-dot" data-font="aqua" data-color="#6af5c8" title="Aqua text"></button>
          <button class="font-dot" data-font="amber" data-color="#ffb347" title="Amber text"></button>
          <button class="font-dot" data-font="rose" data-color="#ff8fb1" title="Rose text"></button>
          <button class="font-dot" data-font="iris" data-color="#b388ff" title="Iris text"></button>
        </div>
        <div class="font-custom" id="font-custom">
          <input type="color" data-target="aqua" value="#6af5c8" aria-label="Choose custom font color 1" />
          <input type="color" data-target="amber" value="#ffb347" aria-label="Choose custom font color 2" />
          <input type="color" data-target="rose" value="#ff8fb1" aria-label="Choose custom font color 3" />
          <input type="color" data-target="iris" value="#b388ff" aria-label="Choose custom font color 4" />
        </div>
      </div>
    </div>
  </header>

  <section class="panel connect floating collapsed" id="connect-panel">
    <div class="panel-head">
      <h2>Connect</h2>
      <span class="hint">needs a Spotify OAuth token</span>
      <button id="connect-close" class="ghost small">Close</button>
    </div>
    <label class="field">
      <span>Client ID (PKCE)</span>
      <input id="client-id-input" type="text" placeholder="Spotify app client ID" autocomplete="off" />
    </label>
    <label class="field">
      <span>Redirect URI</span>
      <input id="redirect-input" type="text" placeholder="https://your-site/callback" autocomplete="off" />
    </label>
    <div class="row">
      <button id="auth-btn" class="primary">Authorize with Spotify (PKCE)</button>
    </div>
    <label class="field">
      <span>OAuth token</span>
      <input id="token-input" type="password" placeholder="Bearer token with streaming + playback scopes" autocomplete="off" />
    </label>
    <div class="row">
      <button id="connect-btn" class="primary">Connect Player</button>
      <button id="disconnect-btn" class="ghost">Disconnect</button>
      <button id="forget-token-btn" class="ghost small">Forget Token</button>
    </div>
    <div class="field">
      <span>Show volume</span>
      <input id="master-volume" type="range" min="0" max="100" value="80" />
    </div>
    <p class="note">Scopes needed: streaming, user-modify-playback-state, user-read-playback-state, user-read-private, user-read-email (for profile sync). The SDK spins up a local player called <strong>Radio Show Deck</strong>.</p>

    <div class="divider"></div>
    <div class="subhead">Supabase</div>
    <label class="field">
      <span>Supabase URL</span>
      <input id="supabase-url" type="text" placeholder="https://xxxx.supabase.co" autocomplete="off" />
    </label>
    <label class="field">
      <span>Supabase anon key</span>
      <input id="supabase-key" type="password" placeholder="anon/public key" autocomplete="off" />
    </label>
    <div class="subhead">SoundCloud</div>
    <label class="field">
      <span>SoundCloud client ID</span>
      <input id="soundcloud-client-id" type="text" placeholder="sc client id (public)" autocomplete="off" />
    </label>
    <div class="row wrap">
      <button id="soundcloud-auth-btn" class="ghost small">Authorize SoundCloud</button>
      <span class="hint" id="soundcloud-auth-status">soundcloud: signed out</span>
    </div>
    <div class="subhead">Supabase Auth</div>
    <label class="field">
      <span>Email</span>
      <input id="supabase-email" type="text" placeholder="you@example.com" autocomplete="email" />
    </label>
    <div class="row wrap">
      <button id="supabase-signin" class="ghost small">Email Link</button>
      <button id="supabase-signout" class="ghost small" disabled>Sign Out</button>
      <span class="hint" id="supabase-auth-status">supabase: signed out</span>
    </div>

    <div class="divider"></div>
    <div class="subhead">Profile</div>
    <label class="field">
      <span>Handle</span>
      <input id="profile-handle" type="text" placeholder="handle (public)" autocomplete="off" />
    </label>
    <div class="row wrap">
      <label class="field small">
        <span>Zip</span>
        <input id="profile-zip" type="text" placeholder="10001" autocomplete="postal-code" />
      </label>
      <label class="field small">
        <span>Location opt-in</span>
        <input id="profile-location-optin" type="checkbox" />
      </label>
      <button id="profile-save-btn" class="ghost small">Save Profile</button>
    </div>

	    <div class="subhead">Follow</div>
	    <div class="row wrap">
	      <label class="field">
	        <span>Follow handle</span>
	        <input id="follow-handle" type="text" placeholder="@someone" autocomplete="off" />
	      </label>
	      <button id="follow-btn" class="ghost small">Follow</button>
	    </div>

	    <div class="subhead">People</div>
	    <div class="row wrap">
	      <label class="field">
	        <span>Search</span>
	        <input id="people-search" type="text" placeholder="handle or name" autocomplete="off" />
	      </label>
	      <button id="people-clear" class="ghost small" type="button">Clear</button>
	    </div>
	    <ul id="people-results" class="list compact-list people-results"></ul>
	  </section>

  <main class="workspace">
    <section class="panel sessions" id="sessions-panel">
      <div class="panel-head">
        <h2>Sessions</h2>
        <span class="hint" id="sessions-status">—</span>
      </div>
      <div class="row wrap">
        <input id="sessions-search" type="text" placeholder="Search sessions" />
	        <select id="sessions-feed">
	          <option value="public">Public</option>
	          <option value="following">Following</option>
	          <option value="nearby">Nearby</option>
	          <option value="inbox">Inbox</option>
	          <option value="live">Live</option>
	          <option value="live_nearby">Live (Nearby)</option>
	        </select>
        <select id="sessions-sort">
          <option value="new">Newest</option>
          <option value="plays">Most plays</option>
          <option value="downloads">Most downloads</option>
          <option value="likes">Most likes</option>
        </select>
        <button id="sessions-refresh" class="ghost small">Refresh</button>
        <button id="go-live-btn" class="ghost small">Go Live</button>
        <button id="end-live-btn" class="ghost small" disabled>End Live</button>
      </div>
      <ul id="sessions-list" class="list"></ul>
    </section>

    <section class="panel recorder">
      <div class="panel-head">
        <h2>Voice Bites</h2>
        <span class="hint">record in-browser</span>
      </div>
      <div class="row wrap">
        <button id="record-btn" class="primary">Start Recording</button>
        <button id="stop-record-btn" class="ghost" disabled>Stop</button>
        <label class="field small">
          <span>Label</span>
          <input id="record-label" type="text" placeholder="Voice bumper" />
        </label>
        <div class="timer" id="record-timer">00:00</div>
      </div>
      <div class="preview" id="record-preview">
        <p>No recording yet.</p>
      </div>
      <button id="add-recording-btn" class="primary wide" disabled>Add to Show</button>
      <div class="row wrap">
        <button id="upload-btn" class="ghost">Upload MP3 / WAV</button>
        <input id="upload-input" type="file" accept="audio/mpeg,audio/mp3,audio/wav,audio/webm" style="display:none" />
      </div>
      <div class="order-box">
        <div class="order-head">Order Tracks</div>
        <ul id="order-list" class="order-list"></ul>
      </div>
    </section>

    <section class="panel show">
      <div class="panel-head">
        <h2>Show Builder</h2>
        <span class="hint" id="show-length">0:00</span>
      </div>
      <div class="row wrap">
        <div class="pill">Apple Music</div>
        <button id="apple-auth-btn" class="ghost small">Connect Apple Music</button>
        <button id="apple-play-btn" class="ghost small" disabled>Play test track</button>
        <span class="hint" id="apple-auth-status">not connected</span>
      </div>
      <div class="row wrap">
        <label class="field">
          <span>Session title</span>
          <input id="session-title" type="text" placeholder="Radio Lab Session" />
        </label>
        <label class="field small">
          <span>Host</span>
          <input id="session-host" type="text" placeholder="Your name" />
        </label>
        <label class="field small">
          <span>Genre</span>
          <input id="session-genre" type="text" placeholder="Genre tags" />
        </label>
        <label class="field small">
          <span>Date</span>
          <input id="session-date" type="date" />
        </label>
        <label class="field small">
          <span>Multi-seed recs</span>
          <input id="multi-seed" type="checkbox" />
        </label>
        <label class="field small">
          <span>Visibility</span>
          <select id="session-visibility">
            <option value="public">Public</option>
            <option value="unlisted">Unlisted</option>
            <option value="followers">Followers</option>
            <option value="friends">Friends</option>
          </select>
        </label>
        <label class="field small">
          <span>Zip</span>
          <input id="session-zip" type="text" placeholder="optional" autocomplete="postal-code" />
        </label>
        <label class="field small">
          <span>Nearby</span>
          <input id="session-location-optin" type="checkbox" />
        </label>
      </div>
      <div class="row wrap">
        <button id="play-show-btn" class="primary">Play Show</button>
        <button id="stop-show-btn" class="ghost">Stop</button>
        <label class="field small">
          <span>Fade (ms)</span>
          <input id="fade-duration" type="number" min="200" max="4000" step="100" value="1200" />
        </label>
        <button id="save-show-btn" class="ghost">Save Show (full)</button>
        <button id="publish-show-btn" class="primary">Publish to Supabase</button>
        <button id="load-show-btn" class="ghost">Load Show</button>
        <button id="save-tracks-btn" class="ghost">Save Tracks Only</button>
        <input id="load-input" type="file" accept="application/json" style="display:none" />
      </div>
      <ul id="segments" class="list segments"></ul>
    </section>
  </main>

  <section class="panel listen">
    <div class="panel-head">
      <h2>Listen Mode</h2>
      <span class="hint">play current or load a show file</span>
    </div>
    <div class="row wrap">
      <input id="listen-file" type="file" accept="application/json" />
      <button id="listen-load" class="ghost">Load Show File</button>
      <button id="listen-play" class="primary">Play Current</button>
      <button id="listen-stop" class="ghost">Stop</button>
    </div>
    <div class="row wrap listen-now">
      <div class="cover" id="listen-cover"></div>
      <div class="now-text">
        <div class="title" id="listen-title">—</div>
        <div class="subtitle" id="listen-subtitle">—</div>
        <div class="subtitle" id="listen-note"></div>
        <div class="progress">
          <div class="progress-bar"><div id="listen-progress"></div></div>
          <div class="progress-bar total"><div id="listen-total"></div></div>
        </div>
      </div>
    </div>
  </section>

  <section class="panel live-room collapsed" id="live-room">
    <div class="panel-head">
      <h2 id="live-room-title">Live Room</h2>
      <span class="hint" id="live-room-subtitle">—</span>
      <button id="live-room-close" class="ghost small">Close</button>
    </div>
    <ul id="live-room-events" class="list live-events"></ul>
    <div class="row live-audio">
      <button id="live-room-audio-btn" class="ghost small" type="button">Enable Audio</button>
      <button id="live-room-mic-btn" class="ghost small" type="button">Enable Mic</button>
      <span class="hint" id="live-room-audio-status">—</span>
    </div>
    <div class="row live-composer">
      <input id="live-room-message" type="text" placeholder="Say something…" autocomplete="off" />
      <button id="live-room-send" class="primary">Send</button>
    </div>
    <audio id="live-room-audio" playsinline></audio>
  </section>

  <noscript class="noscript">Enable JavaScript to use the radio builder.</noscript>
  <script src="app.js" defer></script>
</body>
</html>
